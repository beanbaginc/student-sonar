#!/usr/bin/env ./node_modules/.bin/babel-node

let moment = require('moment'),
    Q = require('q'),
    init = require('../lib/init'),
    schema = require('../lib/schema');

if (process.argv.length !== 5) {
    console.error('Usage: %s [date] [apply-to-groups] [text]', process.argv[1]);
    process.exit();
}

init()
    .then(function(options) {
        let date = moment(process.argv[2]),
            groups = process.argv[3].split(','),
            summary = process.argv[4],
            deferred = Q.defer();

        if (date.isValid()) {
            date = date.utcOffset(0).endOf('day');

            let entry = new schema.CalendarEntry({
                date: date.toDate(),
                show_to_groups: groups,
                summary: summary
            });

            entry.save(deferred.makeNodeResolver());
        } else {
            deferred.reject('Could not parse date');
        }

        return deferred.promise;
    })
    .then(process.exit)
    .catch(console.error.bind(console));
